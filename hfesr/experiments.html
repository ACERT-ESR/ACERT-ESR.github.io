<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Experiments &mdash; 95 GHz ESR Software 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="95 GHz ESR Software 0.9 documentation" href="index.html" />
    <link rel="next" title="OnePulsedAcquisition" href="generated/Experiments.OnePulsedAcquisition.html" />
    <link rel="prev" title="Spectrometer" href="spectrometer.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="generated/Experiments.OnePulsedAcquisition.html" title="OnePulsedAcquisition"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="spectrometer.html" title="Spectrometer"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">95 GHz ESR Software 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="experiments">
<h1>Experiments<a class="headerlink" href="#experiments" title="Permalink to this headline">¶</a></h1>
<div class="section" id="running-experiments">
<h2>Running Experiments<a class="headerlink" href="#running-experiments" title="Permalink to this headline">¶</a></h2>
<p>Most of the Python code to run this experiment is stored as a library.
You run the code by running a script called hfesr.
It initializes
the cards in the computer, requests the username and magnet current,
and defines several experiments that can be run. A sample
session is:</p>
<div class="highlight-python"><div class="highlight"><pre>$ hfesr
95 GHz Spectrometer Interface (C) 2003, 2004, 2005 Wulf Hofbauer
Searching for Acqiris digitizers ...
1 Acqiris card(s) found
PCI::INSTR0 (Serial #16900, PCI address 0.13) model &#39;AP240&#39;
Initializing AP240 digitizer #16900 at PCI 0.13 ...
Using AP240, serial number #16900, for quadrature signal.
Initializing Timing module ...
Initializing EIP535 frequency counter at /dev/gpib0/dev3 ...
Initializing Stanford SR510 lock-in amplifier at /dev/ttyS0 ...
Initializing Stanford SR510 lock-in amplifier at /dev/ttyS1 ...
Initializing Lakeshore 331S temperature controller at /dev/gpib0/dev12 ...

&gt;&gt;&gt; You are running as user &#39;acert&#39;. &lt;&lt;&lt;

Please enter the persistent magnet current [A]: 29.2
Thank you. A main coil current of 29.2 A will be assumed from now on.
This corresponds to a main field of 3.40005 T.
Spectrometer is s. Experiments are dqc128, deer4, and fid.
Print s or any experiment to see its variables.
help(s) or help(experiment) gives more information.
Run an experiment, such as FID, with fid.run().
95 GHz: print deer4
95 GHz: deer4.averages=1000
95 GHz: deer4.run()
</pre></div>
</div>
<p>Each experiment has the methods to show its settings, get help, run, plot,
and print. If you start with an instance of the FID class, stored in the
fid variable, you can find the parameters in that class with the print
function. To see all documentation on FID, use help(fid).</p>
<div class="highlight-python"><div class="highlight"><pre>95 GHz: print fid
FID
  averages=32
  plots=None
  pulse_length=8e-09
  rep_rate=5000
  spectrometer=None
95 GHz: help(fid)
   ...all of its documentation is printed here...
</pre></div>
</div>
<p>All experiments can be run by calling <cite>run()</cite>. The <cite>plot()</cite> function
calls the default plotting routine. There may be other routines,
as in ELDOR, which has another routine to do a contour plot.</p>
<div class="highlight-python"><div class="highlight"><pre>95 GHz: fid.run()
95 GHz: fid.plot()
95 GHz: fid.print_plot()
</pre></div>
</div>
<p>The last call prints the last set of plots you made. You have to make
a plot before it can print one.</p>
</div>
<div class="section" id="tuning">
<h2>Tuning<a class="headerlink" href="#tuning" title="Permalink to this headline">¶</a></h2>
<p>Tuning is an experiment like any other, so it has run and print methods.
As part of the Predefined Experiments (next), there are various tuning methods for different situations.</p>
</div>
<div class="section" id="predefined-experiments">
<h2>Predefined Experiments<a class="headerlink" href="#predefined-experiments" title="Permalink to this headline">¶</a></h2>
<p>The predefined Fourier Transform ESR experiments are implemented using
a shared, generic acquisition routine that implements preflight
checking before the actual data acquisition is started. Beginning
and end of major steps in the process are indicated by messages
to the logging facility. In the case of lengthy preflights
or acquisitions, additiona messages are generated indicating progress.</p>
<p>Following are examples of pulse sequences for various Fourier
Transform ESR experiments. Top to bottom: free induction decay (FID),
spin echo correlation spectroscopy (SECSY), correlation spectroscopy
(COSY), and exchange correlation spectroscopy / 2D electron-electron
double resonance (2D-ELDOR/EXCSY).</p>
<img alt="_images/FTESRexperiments.png" src="_images/FTESRexperiments.png" />
<p class="rubric">Functions</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.OnePulsedAcquisition.html#Experiments.OnePulsedAcquisition" title="Experiments.OnePulsedAcquisition"><code class="xref py py-obj docutils literal"><span class="pre">OnePulsedAcquisition</span></code></a>(spectrometer,&nbsp;...[,&nbsp;addjmp])</td>
<td>This is just like PulsedAcquisition except that it sends all of the sequences and averages over all of them.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.PulsedAcquisition.html#Experiments.PulsedAcquisition" title="Experiments.PulsedAcquisition"><code class="xref py py-obj docutils literal"><span class="pre">PulsedAcquisition</span></code></a>(spectrometer,&nbsp;sequences,&nbsp;...)</td>
<td>Acquires measurements like PulsedAcquistion, except that it crates a 3D array of numbers: [bins x] samples x pulses x phases.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.clearkey.html#Experiments.clearkey" title="Experiments.clearkey"><code class="xref py py-obj docutils literal"><span class="pre">clearkey</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.handle_break.html#Experiments.handle_break" title="Experiments.handle_break"><code class="xref py py-obj docutils literal"><span class="pre">handle_break</span></code></a>(signum,&nbsp;frame)</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.keypress.html#Experiments.keypress" title="Experiments.keypress"><code class="xref py py-obj docutils literal"><span class="pre">keypress</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.plot_data.html#Experiments.plot_data" title="Experiments.plot_data"><code class="xref py py-obj docutils literal"><span class="pre">plot_data</span></code></a>(pl,&nbsp;x,&nbsp;y[,&nbsp;scaling,&nbsp;zeropos,&nbsp;...])</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.test_experiments.html#Experiments.test_experiments" title="Experiments.test_experiments"><code class="xref py py-obj docutils literal"><span class="pre">test_experiments</span></code></a>()</td>
<td>Running every experiment through a mock spectrometer.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.test_experiments_pulseblaster.html#Experiments.test_experiments_pulseblaster" title="Experiments.test_experiments_pulseblaster"><code class="xref py py-obj docutils literal"><span class="pre">test_experiments_pulseblaster</span></code></a>()</td>
<td>Running every experiment through a mock spectrometer using the pulseblaster card.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.test_experiments_tune.html#Experiments.test_experiments_tune" title="Experiments.test_experiments_tune"><code class="xref py py-obj docutils literal"><span class="pre">test_experiments_tune</span></code></a>()</td>
<td>Running Tune.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.test_set_base.html#Experiments.test_set_base" title="Experiments.test_set_base"><code class="xref py py-obj docutils literal"><span class="pre">test_set_base</span></code></a>()</td>
<td></td>
</tr>
</tbody>
</table>
<p class="rubric">Classes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.B1_FID.html#Experiments.B1_FID" title="Experiments.B1_FID"><code class="xref py py-obj docutils literal"><span class="pre">B1_FID</span></code></a>(**kwargs)</td>
<td>This experiment is used for finding B1 using a single-pulse FID method.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.B1_echo.html#Experiments.B1_echo" title="Experiments.B1_echo"><code class="xref py py-obj docutils literal"><span class="pre">B1_echo</span></code></a>(**kwargs)</td>
<td>According to John, this is obsolete.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.B1_se.html#Experiments.B1_se" title="Experiments.B1_se"><code class="xref py py-obj docutils literal"><span class="pre">B1_se</span></code></a>(**kwargs)</td>
<td>This is like B1_echo, but modified by john so the second pulse is twice the first, and so the second ends at &#8220;t = 0&#8221;</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.COSY.html#Experiments.COSY" title="Experiments.COSY"><code class="xref py py-obj docutils literal"><span class="pre">COSY</span></code></a>(**kwargs)</td>
<td>The Correlation Spectroscopy (COSY) class implements a two-pulse correlation spectroscopy experiment.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.COSYAverages.html#Experiments.COSYAverages" title="Experiments.COSYAverages"><code class="xref py py-obj docutils literal"><span class="pre">COSYAverages</span></code></a>(**kwargs)</td>
<td>The Correlation Spectroscopy (COSY) class implements a two-pulse correlation spectroscopy experiment.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.CW.html#Experiments.CW" title="Experiments.CW"><code class="xref py py-obj docutils literal"><span class="pre">CW</span></code></a>(**kwargs)</td>
<td>Field-swept and field-modulated continuous wave ESR experiment.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.Constants.html#Experiments.Constants" title="Experiments.Constants"><code class="xref py py-obj docutils literal"><span class="pre">Constants</span></code></a></td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.DEER3.html#Experiments.DEER3" title="Experiments.DEER3"><code class="xref py py-obj docutils literal"><span class="pre">DEER3</span></code></a>(**kwargs)</td>
<td>DEER 3 pulse experiment: pi/2 - t1 - pi/2 - T - pi/2 - t2</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.DEER4.html#Experiments.DEER4" title="Experiments.DEER4"><code class="xref py py-obj docutils literal"><span class="pre">DEER4</span></code></a>(**kwargs)</td>
<td>4 pulse experiment:</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.DQC.html#Experiments.DQC" title="Experiments.DQC"><code class="xref py py-obj docutils literal"><span class="pre">DQC</span></code></a>(**kwargs)</td>
<td>6 pulse experiment: pi/2 - tp - pi - tp - pi/2 - t1 - pi - t1 - pi/2 - (tm-tp) - pi - t2</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.DQC128.html#Experiments.DQC128" title="Experiments.DQC128"><code class="xref py py-obj docutils literal"><span class="pre">DQC128</span></code></a>(**kwargs)</td>
<td>6 pulse experiment: pi/2 - tp - pi - tp - pi/2 - t1 - pi - t1 - pi/2 - (tm-tp) - pi - t2</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.DQC256.html#Experiments.DQC256" title="Experiments.DQC256"><code class="xref py py-obj docutils literal"><span class="pre">DQC256</span></code></a>(**kwargs)</td>
<td>6 pulse experiment: pi/2 - tp - pi - tp - pi/2 - t1 - pi - t1 - pi/2 - (tm-tp) - pi - t2</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.DQC64.html#Experiments.DQC64" title="Experiments.DQC64"><code class="xref py py-obj docutils literal"><span class="pre">DQC64</span></code></a>(**kwargs)</td>
<td>6 pulse experiment: pi/2 - tp - pi - tp - pi/2 - t1 - pi - t1 - pi/2 - (tm-tp) - pi - t2&#8221;</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.DQCBase.html#Experiments.DQCBase" title="Experiments.DQCBase"><code class="xref py py-obj docutils literal"><span class="pre">DQCBase</span></code></a>(**kwargs)</td>
<td>6 pulse experiment: pi/2 - tp - pi - tp - pi/2 - t1 - pi - t1 - pi/2 - (tm-tp) - pi - t2</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.ELDOR.html#Experiments.ELDOR" title="Experiments.ELDOR"><code class="xref py py-obj docutils literal"><span class="pre">ELDOR</span></code></a>(**kwargs)</td>
<td>The Exchange Correlation Spectroscopy (2D-ELDOR/EXCSY) class implements a three-pulse exchange correlation spectroscopy / 2D electron-electron double resonance spectroscopy experiment.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.ELDOR_3D.html#Experiments.ELDOR_3D" title="Experiments.ELDOR_3D"><code class="xref py py-obj docutils literal"><span class="pre">ELDOR_3D</span></code></a>(**kwargs)</td>
<td>The Exchange Correlation Spectroscopy (2D-ELDOR/EXCSY) class implements a three-pulse exchange correlation spectroscopy / 2D electron-electron double resonance spectroscopy experiment.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.Echo.html#Experiments.Echo" title="Experiments.Echo"><code class="xref py py-obj docutils literal"><span class="pre">Echo</span></code></a>(**kwargs)</td>
<td>The Spin Echo experiment measures T2.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.Experiment.html#Experiments.Experiment" title="Experiments.Experiment"><code class="xref py py-obj docutils literal"><span class="pre">Experiment</span></code></a>()</td>
<td>Every experiment supports these functions.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.FID.html#Experiments.FID" title="Experiments.FID"><code class="xref py py-obj docutils literal"><span class="pre">FID</span></code></a>(**kwargs)</td>
<td>Free induction decay experiment implements a one-pulse free induction decay experiment.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.FIDAverages.html#Experiments.FIDAverages" title="Experiments.FIDAverages"><code class="xref py py-obj docutils literal"><span class="pre">FIDAverages</span></code></a>(**kwargs)</td>
<td>Free induction decay experiment implements a one-pulse free induction decay experiment.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.Loopback.html#Experiments.Loopback" title="Experiments.Loopback"><code class="xref py py-obj docutils literal"><span class="pre">Loopback</span></code></a>(**kwargs)</td>
<td>Modeled after the FID experiment, this is designed to test whether the signal generator and averager are working correctly.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.PulseExperimentBase.html#Experiments.PulseExperimentBase" title="Experiments.PulseExperimentBase"><code class="xref py py-obj docutils literal"><span class="pre">PulseExperimentBase</span></code></a>([field_sweep])</td>
<td>Base class for pulsed experiments, implements on and off-field measurements using sweep coil ..</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.PulseTune.html#Experiments.PulseTune" title="Experiments.PulseTune"><code class="xref py py-obj docutils literal"><span class="pre">PulseTune</span></code></a>(**kwargs)</td>
<td>The Pulse Tune experiment measures T1.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.SECSY.html#Experiments.SECSY" title="Experiments.SECSY"><code class="xref py py-obj docutils literal"><span class="pre">SECSY</span></code></a>(**kwargs)</td>
<td>Spin Echo Correlation Spectroscopy (SECSY).</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.T1_inv.html#Experiments.T1_inv" title="Experiments.T1_inv"><code class="xref py py-obj docutils literal"><span class="pre">T1_inv</span></code></a>(**kwargs)</td>
<td>T1_inv recovery experiment.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.Tune.html#Experiments.Tune" title="Experiments.Tune"><code class="xref py py-obj docutils literal"><span class="pre">Tune</span></code></a>(**kwargs)</td>
<td>This resonator tuning aid generates a sequence of four pulses at 50, 100, 150, and 200 ns after the acquisition trigger with phases of 0, 90, 180, and 270 degrees, respectively, and renders a live display of the received quadrature signal on the screen.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.Tune2.html#Experiments.Tune2" title="Experiments.Tune2"><code class="xref py py-obj docutils literal"><span class="pre">Tune2</span></code></a>(**kwargs)</td>
<td>This is an experiment that is like the FID experiment but used for tuning,     so it runs until a key is pressed.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.Tune3.html#Experiments.Tune3" title="Experiments.Tune3"><code class="xref py py-obj docutils literal"><span class="pre">Tune3</span></code></a>(**kwargs)</td>
<td>This is an experiment that is like the FID experiment but used for tuning,     so it runs until a key is pressed.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.TuneCWConstant.html#Experiments.TuneCWConstant" title="Experiments.TuneCWConstant"><code class="xref py py-obj docutils literal"><span class="pre">TuneCWConstant</span></code></a>(**kwargs)</td>
<td>This is an experiment that is like the FID experiment but used for tuning,     so it runs until a key is pressed.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.TuneCWCycled.html#Experiments.TuneCWCycled" title="Experiments.TuneCWCycled"><code class="xref py py-obj docutils literal"><span class="pre">TuneCWCycled</span></code></a>(**kwargs)</td>
<td>This is an experiment that is like the FID experiment but used for tuning,     so it runs until a key is pressed.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.TuneCycled.html#Experiments.TuneCycled" title="Experiments.TuneCycled"><code class="xref py py-obj docutils literal"><span class="pre">TuneCycled</span></code></a>(**kwargs)</td>
<td>Like the FID experiment, but used for tuning, so it runs until a key is pressed.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.TuneEcho.html#Experiments.TuneEcho" title="Experiments.TuneEcho"><code class="xref py py-obj docutils literal"><span class="pre">TuneEcho</span></code></a>(**kwargs)</td>
<td>For tuning on signal.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.TuneEchoCycled.html#Experiments.TuneEchoCycled" title="Experiments.TuneEchoCycled"><code class="xref py py-obj docutils literal"><span class="pre">TuneEchoCycled</span></code></a>(**kwargs)</td>
<td>For tuning on signal.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/Experiments.echo_T2.html#Experiments.echo_T2" title="Experiments.echo_T2"><code class="xref py py-obj docutils literal"><span class="pre">echo_T2</span></code></a>(**kwargs)</td>
<td>This is modified from B1_se to run a series of echoes with increases interpulse delay.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/Experiments.split_inv_rec.html#Experiments.split_inv_rec" title="Experiments.split_inv_rec"><code class="xref py py-obj docutils literal"><span class="pre">split_inv_rec</span></code></a>(**kwargs)</td>
<td>This implements a split inversion recovery program &#8211; which is four pulses:</td>
</tr>
</tbody>
</table>
<div class="section" id="dqc-phase-cycling">
<h3>DQC Phase Cycling<a class="headerlink" href="#dqc-phase-cycling" title="Permalink to this headline">¶</a></h3>
<p>A whole module was developed for DQC phase cycling.  However, JMF recommends
staying away from this, since it introduces unnecessary complexity, so it was
removed from the manual.</p>
</div>
</div>
<div class="section" id="designing-new-experiments">
<h2>Designing New Experiments<a class="headerlink" href="#designing-new-experiments" title="Permalink to this headline">¶</a></h2>
<p>New experiments can be designed by writing Python code, algorithmically
describing the various steps needed to perform the experiment using the
functionality provided by the <code class="xref py py-mod docutils literal"><span class="pre">Spectrometer</span></code> and supporting modules.</p>
<p>For consistency, it is recommended to follow the general outline of the
predefined experiments.  Note also that these experiments attempt to gather and
preserve a lot of acquisition parameters, easing bookkeeping tasks. In many
cases, these bookkeeping tasks and error checking constitute the main part of
the code.</p>
<p>For one-off experiments, however, it is perfectly possible to define a
simple Python function, hard-coding experimental parameters, etc. To illustrate
this, here is a minimalist (but fully phase-cycled) field-swept echo
experiment, spelled out step by step:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
     <span class="kn">import</span> <span class="nn">Numeric</span><span class="p">;</span>         <span class="c1"># for handling arrays</span>
     <span class="kn">import</span> <span class="nn">PhaseCycling</span><span class="p">;</span>    <span class="c1"># for creating phasecycles</span>
     <span class="kn">import</span> <span class="nn">time</span><span class="p">;</span>            <span class="c1"># for time delays</span>

     <span class="n">rep_rate</span><span class="o">=</span><span class="mi">5000</span><span class="p">;</span>
     <span class="n">averages</span><span class="o">=</span><span class="mi">128</span><span class="p">;</span>

     <span class="c1"># timing in nanoseconds</span>
     <span class="n">pulse_length</span><span class="o">=</span><span class="mi">8</span><span class="p">;</span>
     <span class="n">pulse_separation</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span>

     <span class="c1"># define the sweep range</span>
     <span class="n">B_min</span><span class="o">=</span><span class="mf">3.39</span><span class="p">;</span>
     <span class="n">B_max</span><span class="o">=</span><span class="mf">3.4</span><span class="p">;</span>
     <span class="n">B_steps</span><span class="o">=</span><span class="mi">512</span><span class="p">;</span>

     <span class="c1"># calculate individual magnetic fields and</span>
     <span class="c1"># required sweep coil currents</span>
     <span class="n">fields</span><span class="o">=</span><span class="n">Numeric</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">B_min</span><span class="p">,</span> <span class="n">B_max</span><span class="p">,</span> <span class="p">(</span><span class="n">B_max</span><span class="o">-</span><span class="n">B_min</span><span class="p">)</span><span class="o">/</span><span class="n">B_steps</span><span class="p">);</span>
     <span class="n">sweep_currents</span><span class="o">=</span><span class="p">(</span><span class="n">fields</span><span class="o">-</span><span class="n">s</span><span class="o">.</span><span class="n">get_main_field</span><span class="p">())</span><span class="o">/</span><span class="n">s</span><span class="o">.</span><span class="n">sweep_tesla_per_ampere</span><span class="p">;</span>

     <span class="c1"># use a full CYCLOPS phase cycle</span>
     <span class="n">phasecycle</span><span class="o">=</span><span class="n">PhaseCycling</span><span class="o">.</span><span class="n">FullPhaseCycle</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

     <span class="c1"># create an empty array to hold the data</span>
     <span class="n">data</span><span class="o">=</span><span class="n">Numeric</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phasecycle</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span>
             <span class="n">s</span><span class="o">.</span><span class="n">get_record_length</span><span class="p">()),</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">Complex</span><span class="p">);</span>

     <span class="c1"># loop over all desired fields</span>
     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sweep_currents</span><span class="p">)):</span>

             <span class="c1"># set the sweep coil current</span>
             <span class="n">s</span><span class="o">.</span><span class="n">set_sweep_current</span><span class="p">(</span><span class="n">sweep_currents</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

             <span class="c1"># let the field settle for a bit</span>
             <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">);</span>

             <span class="c1"># loop over all phase combinations</span>
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phasecycle</span><span class="p">)):</span>
                     <span class="n">phases</span><span class="o">=</span><span class="n">phasecycle</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>

                     <span class="c1"># define pulse sequence</span>
                     <span class="n">ps</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="n">pulse_separation</span><span class="o">-</span><span class="n">pulse_length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                             <span class="n">pulse_length</span><span class="p">,</span> <span class="n">phases</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                             <span class="p">(</span><span class="o">-</span><span class="n">pulse_length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">pulse_length</span><span class="p">,</span>
                             <span class="n">phases</span><span class="p">[</span><span class="mi">1</span><span class="p">])];</span>

                     <span class="c1"># compile sequence to a program</span>
                     <span class="n">pp</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">compile_pulse_program</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span>
                             <span class="n">rep_rate</span><span class="p">);</span>

                     <span class="c1"># start averager and run the pulse program</span>
                     <span class="n">s</span><span class="o">.</span><span class="n">start_averager</span><span class="p">(</span><span class="n">averages</span><span class="p">);</span>
                     <span class="n">s</span><span class="o">.</span><span class="n">run_pulse_program</span><span class="p">(</span><span class="n">pp</span><span class="p">);</span>

                     <span class="c1"># wait until the averager is done</span>
                     <span class="k">while</span> <span class="n">s</span><span class="o">.</span><span class="n">averager_busy</span><span class="p">():</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">);</span>

                     <span class="c1"># read out averager</span>
                     <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">read_averager</span><span class="p">();</span>

     <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
</pre></div>
</div>
<p>To run the experiment, the function would be called with the
<code class="xref py py-mod docutils literal"><span class="pre">Spectrometer</span></code> module as its argument. On completion, the function
returns a 3D data array, where the first index represents the step in the
phasecycle, the second the magnetic field, and the third the time axis.</p>
<p>Such code might be written on the fly using a text editor, and the function
declaration loaded using the Python <code class="docutils literal"><span class="pre">execfile</span></code> function.</p>
<p>A simple, non-phasecycled FID experiment might even be conducted completely
from the command line:</p>
<div class="highlight-python"><div class="highlight"><pre>95 GHz: s=Spectrometer
95 GHz: ps=[(-4, 8, 0)]         # a single pulse
95 GHz: pp=s.compile_pulse_program(ps, 4096, 5000)
95 GHz: s.start_averager(4096)
95 GHz: pp.run()
95 GHz: s.averager_busy()       # check if acquisition done
1
95 GHz: s.averager_busy()
0
95 GHz: data=s.read_averager()
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Experiments</a><ul>
<li><a class="reference internal" href="#running-experiments">Running Experiments</a></li>
<li><a class="reference internal" href="#tuning">Tuning</a></li>
<li><a class="reference internal" href="#predefined-experiments">Predefined Experiments</a><ul>
<li><a class="reference internal" href="#dqc-phase-cycling">DQC Phase Cycling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#designing-new-experiments">Designing New Experiments</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="spectrometer.html"
                        title="previous chapter">Spectrometer</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="generated/Experiments.OnePulsedAcquisition.html"
                        title="next chapter">OnePulsedAcquisition</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/experiments.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="generated/Experiments.OnePulsedAcquisition.html" title="OnePulsedAcquisition"
             >next</a> |</li>
        <li class="right" >
          <a href="spectrometer.html" title="Spectrometer"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">95 GHz ESR Software 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, John Franck, Drew Dolgert, Curt Dunnam.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>